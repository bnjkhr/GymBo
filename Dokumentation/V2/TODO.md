# GymBo V2 - TODO Liste

**Stand:** 2025-10-24
**Current Phase:** ‚úÖ MVP COMPLETE - All Core Features Implemented
**Next Phase:** Nice-to-Have Features & Polish
**Letzte √Ñnderungen:** Session 8+ complete, Dokumentation aktualisiert

---

## ‚úÖ MVP COMPLETE - Alle Core Features Implementiert!

### Was ist FERTIG (Production Ready):

**1. Workout Management** ‚úÖ
- Create/Edit/Delete Workouts
- Toggle Favorite
- WorkoutStore mit allen Use Cases
- Pull-to-refresh

**2. Exercise Library** ‚úÖ
- 145+ √úbungen aus CSV
- Search & Filter (Muskelgruppe, Equipment)
- ExercisesView komplett implementiert
- ExerciseDetailView mit Instructions

**3. Workout Detail & Exercise Management** ‚úÖ
- Add Multiple Exercises (Multi-Select Picker)
- Edit Exercise Details (Sets, Reps, Time, Weight, Rest, Notes)
- Remove Exercise
- Reorder Exercises (Drag & Drop mit permanent save)
- Exercise Names werden geladen & angezeigt

**4. Active Workout Session** ‚úÖ
- Start/End/Cancel Session
- Complete/Uncomplete Sets
- Add/Remove Sets
- Update Set Weight/Reps
- Update All Sets
- Exercise Notes
- Auto-Finish Exercise
- Reorder Exercises (session-only oder permanent)
- Rest Timer (90s mit ¬±15s)
- Show/Hide completed
- Exercise Counter
- Session Persistence & Restoration

**5. UI/UX** ‚úÖ
- Modern Dark Theme
- 39pt Corner Radius
- Inverted Checkboxes
- Haptic Feedback
- Success Pills
- Profile Button (HomeView)
- iOS 26 Modern Card Design

**6. Architecture** ‚úÖ
- Clean Architecture (4 Layers)
- 17 Use Cases
- 3 Repositories + Mappers
- 2 Stores @Observable
- DI Container
- SwiftData Migration Plan (SchemaV1, SchemaV2, GymBoMigrationPlan)

---

## üü¢ Optional - Migration Support (F√ºr Zukunft)

### SwiftData Migration Support (DONE - bereits implementiert!)
**Status:** ‚úÖ IMPLEMENTED (GymBoMigrationPlan.swift, SchemaV1.swift, SchemaV2.swift)
**Location:** `/Data/Migration/`

**Was bereits vorhanden:**
- ‚úÖ SchemaV1 mit allen V1 Entities
- ‚úÖ SchemaV2 mit Migration (exerciseId hinzugef√ºgt)
- ‚úÖ GymBoMigrationPlan registriert
- ‚úÖ ModelContainer nutzt Migration Plan (Production Mode)
- ‚úÖ DEBUG Mode: Database deletion DISABLED (commented out)

**N√§chste Schritte (optional):**
- [ ] Write Unit Tests f√ºr Migrations
- [ ] Test Migration mit verschiedenen iOS Versionen
- [ ] Document Schema Change Process

---

## üìù Session 6 Complete (2025-10-23) - PRODUCTION-READY REORDERING

### ‚úÖ Implementierte Features:

**1. Exercise Reordering Feature**
- Drag & drop reordering in active sessions
- **Permanent save toggle** (updates workout template)
- ReorderExercisesSheet (dedicated UI, verhindert Button-Auto-Trigger Bug)
- Production-ready mit explizitem orderIndex handling

**2. Auto-Finish Exercise**
- Exercises auto-finish when all sets completed
- Auto un-finish when set uncompleted
- Integrated in CompleteSetUseCase

**3. Production-Ready Fixes (Critical!)**
- **StartSessionUseCase**: Uses explicit orderIndex from templates (not array position)
- **WorkoutMapper**: In-place updates (preserves SwiftData relationships)
- **SessionMapper**: Correctly updates orderIndex during reordering
- **All mappers**: Avoid entity recreation (performance + stability)

### üß™ Testing Status:
- ‚úÖ Session-only reorder works
- ‚úÖ Permanent template reorder works
- ‚úÖ Auto-finish works on last set completion
- ‚úÖ UI updates immediately
- ‚úÖ No exercise deletion or corruption

### üì¶ Files Changed (12):
- `SessionMapper.swift` - orderIndex update fix
- `WorkoutMapper.swift` - in-place updates
- `StartSessionUseCase.swift` - explicit orderIndex
- `CompleteSetUseCase.swift` - auto-finish logic
- `SwiftDataWorkoutRepository.swift` - updateExerciseOrder()
- `WorkoutRepositoryProtocol.swift` - new method
- `SessionStore.swift` - reorder with permanent save
- `ActiveWorkoutSheetView.swift` - ReorderExercisesSheet
- `DependencyContainer.swift` - workoutRepository injection
- `WorkoutSeedData.swift` - TEST Multi Exercise workout

**Commit:** `30b3e6f` - "feat: Production-ready exercise reordering with auto-finish"

---

## üìù Session Notes (2025-10-22)

### Erledigte Fixes heute:
1. ‚úÖ **orderIndex Bug** - Sets/Exercises haben jetzt explizite Reihenfolge (SwiftData @Relationship hat keine garantierte Order!)
2. ‚úÖ **@Observable Migration** - Von ObservableObject zu iOS 17+ @Observable f√ºr bessere Reaktivit√§t
3. ‚úÖ **Timer Auto-Start** - Timer startet nicht mehr automatisch beim Workout-Launch
4. ‚úÖ **Timer Always Visible** - TimerSection zeigt immer entweder Rest Timer ODER Workout Duration
5. ‚úÖ **Doppel-Tap Bug** - Sets k√∂nnen jetzt mit einem Klick abgehakt werden
6. ‚úÖ **UI Cleanup** - Duplicate kg/reps Labels entfernt

### Wichtige Learnings:
- **SwiftData @Relationship Arrays haben KEINE garantierte Reihenfolge!** ‚Üí Immer `orderIndex` verwenden
- **@Observable ist besser als ObservableObject** f√ºr komplexe State-Updates in SwiftUI
- **TextField in ForEach kann zu Crashes f√ºhren** ‚Üí Erstmal als separates Feature planen
- **UUIDs statt Array-Indices** verwenden f√ºr eindeutige Identifikation (wichtig f√ºr Reordering!)

### Offene TODOs f√ºr n√§chste Session:
- Weight/Reps editierbar machen (neuer Ansatz mit Sheet/Alert statt inline TextFields)
- Exercise Names aus Repository laden (aktuell: "√úbung 1", "√úbung 2")
- UpdateSetUseCase implementieren f√ºr persistente Weight/Reps √Ñnderungen

---

## üéØ N√§chste Features (Nice-to-Have)

### ‚úÖ ERLEDIGT: Exercise Names, Equipment, Workout Repository

Die folgenden Punkte wurden bereits implementiert:
- ‚úÖ Exercise Names werden angezeigt (aus ExerciseRepository)
- ‚úÖ Equipment wird angezeigt (Icons in WorkoutDetailView)
- ‚úÖ Workout Repository ist fertig (SwiftDataWorkoutRepository)
- ‚úÖ Exercise Repository ist fertig (SwiftDataExerciseRepository)
- ‚úÖ ExercisesView mit Search & Filter

---

## üöÄ Neue Features (aus notes.md)

### 1. Exercise Swap Feature (Medium Effort - 4-6 Std)
**Ziel:** Lange auf √úbung dr√ºcken ‚Üí Alternative √úbungen vorschlagen

**User Story:**
- User dr√ºckt lange auf √úbung in Workout Detail
- App zeigt Sheet mit gleichwertigen Alternativen (gleiche Muskelgruppe)
- User kann ausw√§hlen oder selbst suchen
- Toggle: "√Ñnderung dauerhaft speichern" (in Template) oder nur f√ºr diese Session

**Implementation:**
```swift
// In WorkoutDetailView oder CompactExerciseCard
.onLongPressGesture {
    showExerciseSwapSheet = true
}

// ExerciseSwapSheet
- Load alternatives from ExerciseRepository (same muscle groups)
- Show list with search
- Toggle: savePermanently
- OnConfirm: Update workout template or session
```

**Dateien:**
- `/Presentation/Views/WorkoutDetail/ExerciseSwapSheet.swift` - NEW
- `/Domain/UseCases/Workout/SwapExerciseUseCase.swift` - NEW
- Update `WorkoutDetailView.swift`

---

### 2. Profile Page (Low Effort - 2-3 Std)
**Ziel:** Profilseite implementieren (Button ist schon da!)

**Features:**
- User Name & Profilbild
- Standardprofilbild wenn nicht gesetzt
- Settings (Theme, Rest Timer defaults)
- About Section (Version, Credits)

**Dateien:**
- `/Presentation/Views/Profile/ProfileView.swift` - Aktuell Placeholder, erweitern!
- `/Domain/Entities/UserProfile.swift` - Optional: Domain Model
- `/SwiftDataEntities.swift` - UserProfileEntity bereits vorhanden!

---

### 3. HomeView Redesign ‚úÖ COMPLETE (Session 2025-10-24 Abend)
**Status:** ‚úÖ Implementiert und gebaut

**Implementierte Features:**
1. ‚úÖ Zeitbasierte Begr√º√üung ("Hey, guten Morgen!" / "Hey!" / "Hey, guten Abend!")
2. ‚úÖ Spintnummer-Widget mit Lock/Unlock States
3. ‚úÖ Workout Calendar Strip (14 Tage, Streak-Badge, Auto-Scroll)
4. ‚úÖ Repository-Erweiterung: `fetchCompletedSessions(from:to:)`

**Neue Dateien:**
- ‚úÖ `/Presentation/Views/Home/Components/GreetingHeaderView.swift`
- ‚úÖ `/Presentation/Views/Home/Components/LockerNumberInputSheet.swift`
- ‚úÖ `/Presentation/Views/Home/Components/WorkoutCalendarStripView.swift`

**Technische Details:**
- Spintnummer: `@AppStorage("lockerNumber")` f√ºr Persistierung
- Begr√º√üung: `.largeTitle` Font (konsistent mit anderen Views)
- Calendar: L√§dt Sessions aus letzten 14 Tagen, berechnet Streak
- Design: iOS-native Components, Haptic Feedback

**Build Status:** ‚úÖ BUILD SUCCEEDED

---

### 4. Session History (2-3 Stunden)
**Ziel:** Vergangene Workouts anzeigen

**Features:**
- Liste vergangener Sessions
- Filter nach Workout-Typ
- Session Detail View (read-only)
- Statistiken (Total Volume, Duration)

**UI:**
- Neuer Tab "Verlauf" oder in Progress Tab
- Session Cards mit Datum, Name, Stats

**Dateien:**
- `/Presentation/Views/History/SessionHistoryView.swift` - NEW
- `/Presentation/Views/History/SessionDetailView.swift` - NEW
- `/Domain/UseCases/Session/GetSessionHistoryUseCase.swift` - NEW
- Update `SessionRepository` mit `fetchRecentSessions()`

---

### 5. Localization Support (3-4 Stunden)
**Ziel:** App f√ºr √úbersetzung vorbereiten

**Tasks:**
- Strings.swift mit allen Texten
- NSLocalizedString wrapper
- Localizable.strings (de, en)
- Export/Import Workflow

**Dateien:**
- `/Infrastructure/Localization/Strings.swift` - NEW
- `/Resources/de.lproj/Localizable.strings` - NEW
- `/Resources/en.lproj/Localizable.strings` - NEW

---

---

## üìä Langfristig (Phase 2)

### 6. Statistics & Charts (Phase 3)
- Workout-Frequenz (Heatmap Calendar)
- Volumen-Trends (Line Charts)
- Personal Records (PRs)
- Progress per Exercise
- SwiftUI Charts Framework

### 7. Advanced Workout Builder
- Templates & Folders
- Superset Support
- Drop Sets, Pyramid Sets
- Custom Rest Timer per Exercise

### 8. Cloud Sync & Social
- iCloud Sync
- Share Workouts
- Social Feed (optional)

### 9. AI Features (Phase 4)
- Workout Generator (AI-basiert)
- Form Check (Video Analysis)
- Smart Progression Suggestions

---

## ‚úÖ ABGESCHLOSSEN (Sessions 1-8+)

### Session 8+ (2025-10-24) - Documentation Update
- ‚úÖ Reviewed entire codebase
- ‚úÖ Updated README.md with actual status
- ‚úÖ Updated TODO.md with new priorities
- ‚úÖ Confirmed all MVP features complete

### Session 7 (2025-10-23) - Workout Management Complete
- ‚úÖ Create/Edit/Delete Workouts
- ‚úÖ Multi-select ExercisePicker
- ‚úÖ Exercise Detail Editor (Time/Reps toggle)
- ‚úÖ Standardized headers
- ‚úÖ Fixed HomeView refresh bug

**Was implementiert wurde:**
- ‚úÖ Exercise drag & drop reordering in active sessions
- ‚úÖ Permanent save toggle (saves to workout template)
- ‚úÖ ReorderExercisesSheet with dedicated UI
- ‚úÖ Production-ready with explicit orderIndex
- ‚úÖ In-place updates in WorkoutMapper & SessionMapper
- ‚úÖ Auto-finish exercise when all sets completed

**Was noch aussteht:**
- [ ] Set reordering within exercises
- [ ] Undo/redo for reordering
- [ ] Haptic feedback during drag

**Original Requirements (ERF√úLLT):**
- ‚úÖ **NIEMALS Index verwenden** f√ºr Identifikation
- ‚úÖ **IMMER UUID verwenden** f√ºr eindeutige Identifikation
- ‚úÖ Neue Reihenfolge wird im Workout persistiert
- ‚úÖ orderIndex to Entities added
   }
   
   // Domain/Entities/SessionSet.swift
   struct DomainSessionSet {
       let id: UUID
       var orderIndex: Int  // ‚Üê NEU: Explizite Reihenfolge
       // ...
   }
   ```

2. **Add ReorderExerciseUseCase**
   ```swift
   protocol ReorderExerciseUseCase {
       func execute(
           sessionId: UUID,
           exerciseId: UUID,
           newIndex: Int
       ) async throws -> DomainWorkoutSession
   }
   ```

3. **Add ReorderSetUseCase**
   ```swift
   protocol ReorderSetUseCase {
       func execute(
           sessionId: UUID,
           exerciseId: UUID,
           setId: UUID,
           newIndex: Int
       ) async throws -> DomainWorkoutSession
   }
   ```

4. **UI Implementation**
   ```swift
   // In ActiveWorkoutSheetView.swift
   ForEach(session.exercises.sorted(by: { $0.orderIndex < $1.orderIndex })) { exercise in
       CompactExerciseCard(...)
   }
   .onMove { indices, newOffset in
       Task {
           // Get exerciseId (NOT index!)
           let exerciseId = session.exercises[indices.first!].id
           await sessionStore.reorderExercise(
               exerciseId: exerciseId,
               newIndex: newOffset
           )
       }
   }
   
   // In CompactExerciseCard.swift
   ForEach(exercise.sets.sorted(by: { $0.orderIndex < $1.orderIndex })) { set in
       CompactSetRow(set: set)
   }
   .onMove { indices, newOffset in
       // Get setId (NOT index!)
       let setId = exercise.sets[indices.first!].id
       onReorderSet?(setId, newOffset)
   }
   ```

5. **Persistence**
   - Update SwiftData Entities mit orderIndex
   - Mapper aktualisieren
   - Repository speichert neue Reihenfolge

**Warum orderIndex statt Array-Position?**
- ‚úÖ Explizit persistiert in Datenbank
- ‚úÖ Unabh√§ngig von Filter/Sort in UI
- ‚úÖ Robust bei concurrency
- ‚úÖ Erm√∂glicht Undo/Redo in Zukunft

**Testing:**
- User verschiebt √úbung 3 nach Position 1
- App restart ‚Üí Reihenfolge bleibt erhalten
- Set-Completion funktioniert weiterhin korrekt

**Dateien:**
- `/Domain/Entities/SessionExercise.swift` - Add orderIndex
- `/Domain/Entities/SessionSet.swift` - Add orderIndex
- `/Domain/UseCases/Session/ReorderExerciseUseCase.swift` - NEW
- `/Domain/UseCases/Session/ReorderSetUseCase.swift` - NEW
- `/Data/SwiftDataEntities.swift` - Update entities
- `/Data/Mappers/SessionMapper.swift` - Map orderIndex
- `/Presentation/Stores/SessionStore.swift` - Add reorder functions
- `/Presentation/Views/ActiveWorkout/ActiveWorkoutSheetView.swift` - Add .onMove
- `/Presentation/Views/ActiveWorkout/Components/CompactExerciseCard.swift` - Add .onMove

---

### 8. Statistics (Phase 3 aus TECHNICAL_CONCEPT_V2.md)
- Workout-Frequenz
- Volumen-Trends
- Personal Records (PRs)
- Charts (SwiftUI Charts)

### 9. Workout Builder (Phase 2 aus UX_CONCEPT_V2.md)
- Drag & Drop Exercises
- Template Management
- Folders

### 9. Profile & Settings
- User Profile
- Rest Timer Defaults
- Theme Settings

### 10. Testing
- Integration Tests (Store + Use Case)
- UI Tests (Critical Flows)
- Performance Tests

---

## üêõ Bug-Fixes (Alle erledigt!)

- ‚úÖ ~~"Keine √úbungen" nach Set-Completion~~ (In-place updates)
- ‚úÖ ~~Rest Timer startet nur einmal~~ (Timer nach jedem Set)

---

## üîß Technical Debt

### 1. Ordnerstruktur aufr√§umen (30 Min) üü° OPTIONAL
**Problem:** `GymBo/GymBo/GymBo/` verschachtelt  
**L√∂sung:** Flache Struktur (NACH MVP stabilisiert)  
**Risiko:** Xcode .pbxproj absolute Pfade k√∂nnten brechen

### 2. Logging verbessern (1 Stunde)
**Aktuell:** print() Statements  
**Besser:** Structured Logging mit AppLogger

```swift
AppLogger.session.info("Set completed", metadata: [
    "exerciseId": "\(exerciseId)",
    "setId": "\(setId)"
])
```

### 3. Error Handling verbessern
**Aktuell:** print() bei Fehlern  
**Besser:** User-facing Error Messages

```swift
@Published var errorMessage: String?

// In Store:
catch {
    errorMessage = error.localizedDescription
}

// In View:
.alert("Fehler", isPresented: $showError) {
    Text(sessionStore.errorMessage ?? "Unbekannter Fehler")
}
```

### 4. Preview Data auslagern
**Aktuell:** Preview Helper in Production Code  
**Besser:** Separate Preview Target

---

## üìã Feature-Priorisierung (Empfehlung)

### Must-Have (MVP Launch)
1. ‚úÖ Session Management ‚Üê **FERTIG**
2. ‚úÖ Active Workout UI ‚Üê **FERTIG**
3. üî¥ Exercise Names ‚Üê **N√ÑCHSTES**
4. üî¥ Workout Repository ‚Üê **DANACH**
5. üî¥ Session History (simple Liste)

### Nice-to-Have (v2.1)
6. Statistics & Charts
7. Workout Builder
8. Exercise Database (erweitert)
9. Profile & Settings

### Future (v2.2+)
10. Cloud Sync
11. Social Features
12. AI Workout Generator
13. Video Tutorials

---

## üéØ N√§chste Session - Quick Win (2 Stunden)

**Ziel:** Exercise Names + Equipment anzeigen

**Checklist:**
- [ ] Add `exerciseName: String?` to SessionExercise
- [ ] Add `equipment: String?` to SessionExercise
- [ ] Update test data in StartSessionUseCase
- [ ] Update CompactExerciseCard to use names
- [ ] Build & Test
- [ ] Screenshot f√ºr Dokumentation

**Ergebnis:**
```
Statt: "√úbung 1"
Jetzt: "Bankdr√ºcken (Barbell)"
```

---

## üìä Definition of Done

**Ein Feature ist "fertig" wenn:**
- ‚úÖ Code kompiliert ohne Warnings
- ‚úÖ Feature funktioniert im Simulator
- ‚úÖ Grundlegende Tests vorhanden (Domain Layer)
- ‚úÖ Code folgt Clean Architecture
- ‚úÖ Keine hardcoded Magic Numbers
- ‚úÖ Deutsche Lokalisierung
- ‚úÖ Dokumentation aktualisiert (CURRENT_STATE.md)

---

## üìö Referenzen

- `CURRENT_STATE.md` - Aktueller Implementierungsstatus
- `TECHNICAL_CONCEPT_V2.md` - Vollst√§ndige Architektur
- `UX_CONCEPT_V2.md` - UX/UI Konzept & User Flows
- `ACTIVE_WORKOUT_REDESIGN.md` - Design-Prozess (historisch)

---

**Letzte Aktualisierung:** 2025-10-22 22:40

---

## üîÆ Phase 2: Progression Features (Future)

**Status:** üìã PLANNED - Fully documented, ready for implementation  
**Documentation:** See `PROGRESSION_FEATURE_PLAN.md` (detailed) or `PROGRESSION_QUICK_REF.md` (quick overview)  
**Estimated Time:** ~14 hours  
**Dependencies:** Workout Repository (Phase 1) must be complete first

### What's Ready

‚úÖ **Complete feature specification**
- Linear Progression, Double Progression, Wave Loading strategies
- Data model extensions documented
- Clean Architecture implementation plan
- UI/UX mockups and flows

‚úÖ **No breaking changes**
- All new fields are optional
- Backward compatible with Phase 1
- User can opt-in per workout

‚úÖ **All raw data already captured**
- ExerciseEntity tracks lastUsed*
- ExerciseRecordEntity tracks PRs + 1RM
- UserProfileEntity has goals/experience
- WorkoutSessionEntity has complete history

### Quick Overview

**New Entities:**
- `ProgressionEventEntity` - Track all progression events (increases, deloads)

**Entity Extensions:**
- `WorkoutEntity`: Add `progressionStrategyRaw`, `defaultTargetReps*`
- `WorkoutExerciseEntity`: Add `progressionIncrement`, `autoProgressionDisabled`
- `WorkoutSessionEntity`: Add `perceivedDifficulty` (RPE)

**Use Cases:**
- `SuggestProgressionUseCase` - Analyze history, suggest next workout values
- `RecordProgressionEventUseCase` - Log progression events
- `GetProgressionHistoryUseCase` - Display progression timeline

**UI Components:**
- Progression suggestion banner (accept/decline)
- Progression settings in workout editor
- Progression timeline view

### When to Start Phase 2

**Start when:**
1. ‚úÖ Workout Repository is complete and tested
2. ‚úÖ User can select workouts from database
3. ‚úÖ Sessions load real workout templates
4. ‚úÖ App is stable with Phase 1 features

**Don't start if:**
- Workout Repository has bugs
- Session flow isn't working reliably
- Data model is still changing

---

## üìö Documentation Index

- `CURRENT_STATE.md` - Current implementation status (Session 4)
- `TODO.md` - This file - Task prioritization
- `TECHNICAL_CONCEPT_V2.md` - Architecture details
- `UX_CONCEPT_V2.md` - UI/UX design
- `PROGRESSION_FEATURE_PLAN.md` - ‚≠ê NEW: Complete Phase 2 specification
- `PROGRESSION_QUICK_REF.md` - ‚≠ê NEW: Quick reference for Phase 2

---

---

**Last Updated:** 2025-10-24 (Abend) - HomeView Redesign Complete
